<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Client-Server Websocket</title>
        <link rel="stylesheet" href="/static/test.css">
        <script src="/static/jquery-3.1.0.min.js" type="application/javascript"></script>

    </head>
    <body>
    <h1>Websocket connection</h1>
    <form id="file-form" action="handler.php" method="POST">
        <input type="file" id="file-select" name="photo" multiple/>
        <button type="submit" id="upload-button">Upload</button>
    </form>
        <a href="javascript:WebSocketTest()">Run WebSocket</a>
    </body>
    <script type="text/javascript">
        window.onload = function () {
            var ws = new WebSocket("ws://localhost:8888/websocket?Id=123456789");
            ws.onopen = function(){
                ws.send("Connected");
            };
            ws.onmessage = function(evt){
                console.log(evt.data);
            };
        };
        var form = document.getElementById('file-form');
        var fileSelect = document.getElementById('file-select');
        var uploadButton = document.getElementById('upload-button');
        form.onsubmit = function(event) {
            event.preventDefault();

            // Update button text.
            uploadButton.innerHTML = 'Uploading...';

            // Get the selected files from the input.
            var file = fileSelect.files[0];


            // Create a new FormData object.
            var formData = new FormData(form);
//            console.log(file);
            formData.append('file',file);

            var xhr = new XMLHttpRequest();

            // Open the connection.
            xhr.open('POST', 'http://localhost:8888/uploads', true);

            // Set up a handler for when the request finishes.
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // File(s) uploaded.
                    uploadButton.innerHTML = 'Upload';
                } else {
                    alert('An error occurred!');
                }
            };

            // Send the Data.
            xhr.send(formData);

        }


    </script>
</html>